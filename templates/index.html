<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cdn.jsdelivr.net https://www.gstatic.com https://translate.google.com https://translate.googleapis.com https://translate-pa.googleapis.com https://cdnjs.cloudflare.com https://apis.google.com https://*.firebaseio.com https://*.firebase.com https://*.firebaseauth.com https://identity.security.googleapis.com https://identitytoolkit.googleapis.com; connect-src 'self' https://translate.googleapis.com https://translate.google.com https://translate-pa.googleapis.com https://*.firebaseio.com https://*.googleapis.com https://identitytoolkit.googleapis.com wss://*.firebaseio.com https://firestore.googleapis.com; img-src 'self' data: blob: https://translate.googleapis.com https://translate.google.com https://fonts.gstatic.com https://www.gstatic.com https://*.googleapis.com; style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://translate.googleapis.com https://www.gstatic.com https://cdnjs.cloudflare.com; font-src 'self' https://cdnjs.cloudflare.com https://fonts.gstatic.com; frame-src 'self' https://accounts.google.com https://apis.google.com;">
    <title>Plant Disease Detection AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <!-- Google Translate API -->
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,hi,ta,te,ml,kn,bn,gu,pa,ne,si,ur,as,or,sa,ks,mr',
                layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL,
                autoDisplay: false
            }, 'google_translate_element');
            
            // Listen for translation completion
            setTimeout(function() {
                const select = document.querySelector('.goog-te-combo');
                if (select) {
                    // Reset to English if not explicitly set to another language
                    ensureEnglishDefault(select);
                    
                    select.addEventListener('change', function() {
                        const selectedText = this.options[this.selectedIndex] ? this.options[this.selectedIndex].text : 'Language';
                        document.getElementById('currentLanguage').innerText = selectedText;
                        document.getElementById('currentLanguageMobile').innerText = selectedText;
                        
                        // Save language selection to sessionStorage
                        sessionStorage.setItem('userSelectedLanguage', this.value);
                    });
                }
                
                // Hide Google top bar
                hideGoogleBar();
            }, 1000);
        }
        
        // Function to ensure the page starts in English
        function ensureEnglishDefault(select) {
            // Check for user saved language preference first
            const savedLang = sessionStorage.getItem('userSelectedLanguage');
            if (savedLang) {
                // Find and select the saved language
                for (let i = 0; i < select.options.length; i++) {
                    if (select.options[i].value === savedLang) {
                        select.selectedIndex = i;
                        
                        // Update both display texts
                        const selectedText = select.options[i].text;
                        document.getElementById('currentLanguage').innerText = selectedText;
                        document.getElementById('currentLanguageMobile').innerText = selectedText;
                        
                        // Trigger change event to apply translation
                        const event = new Event('change', { bubbles: true });
                        select.dispatchEvent(event);
                        return; // Exit early since we found and applied saved language
                    }
                }
            }
            
            // If no language is selected or page was auto-translated to a non-English language
            if (select.value && select.value !== 'en') {
                // Check if auto-translated
                if (!sessionStorage.getItem('userSelectedLanguage')) {
                    // Reset to English
                    select.value = 'en';
                    const event = new Event('change', { bubbles: true });
                    select.dispatchEvent(event);
                }
            }
            
            // Update the display text
            const currentLang = select.value || 'en';
            const langDisplay = currentLang === 'en' ? 'English' : 
                               (select.options[select.selectedIndex] ? select.options[select.selectedIndex].text : 'Language');
            document.getElementById('currentLanguage').innerText = langDisplay;
            document.getElementById('currentLanguageMobile').innerText = langDisplay;
        }

        function translatePage(lang) {
            // Store user language selection
            sessionStorage.setItem('userSelectedLanguage', lang);
            
            // Find the translate element's dropdown
            var select = document.querySelector('.goog-te-combo');
            if (select) {
                // If it's already in English and we're trying to select English again, force a reset
                if (lang === 'en' && select.value === 'en') {
                    // Force reload to reset to original English
                    window.location.reload();
                    return;
                }
                
                // Update the dropdown value
                for (var i = 0; i < select.options.length; i++) {
                    if (select.options[i].value === lang) {
                        select.selectedIndex = i;
                        // Update display text safely for both selectors
                        const selectedText = select.options[i] ? select.options[i].text : 'Language';
                        document.getElementById('currentLanguage').innerText = selectedText;
                        document.getElementById('currentLanguageMobile').innerText = selectedText;
                        break;
                    }
                }
                // Trigger the change event
                var event = new Event('change', { bubbles: true });
                select.dispatchEvent(event);
                
                // Hide Google top bar after translation
                setTimeout(hideGoogleBar, 1000);
            }
        }
        
        // Function to hide the Google Translate bar
        function hideGoogleBar() {
            // Hide the Google translate bar
            const googleTopBar = document.querySelector('.skiptranslate');
            if (googleTopBar) {
                googleTopBar.style.display = 'none';
            }
            
            // Also fix the body position that Google modifies
            if (document.body.style.top) {
                document.body.style.top = '0px';
            }
        }
        
        // Set up observer to hide Google bar whenever it appears
        document.addEventListener('DOMContentLoaded', function() {
            // Create an observer instance to watch for the Google bar
            const observer = new MutationObserver(function(mutations) {
                hideGoogleBar();
            });
            
            // Start observing the body for added nodes
            observer.observe(document.body, { childList: true, subtree: true });
            
            // Also set up CSS to hide it permanently
            const style = document.createElement('style');
            style.textContent = `
                .skiptranslate, .goog-te-banner-frame {
                    display: none !important;
                    visibility: hidden !important;
                }
                body {
                    top: 0px !important;
                }
            `;
            document.head.appendChild(style);
        });
    </script>
    <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>

    <!-- Initialize Firebase -->
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "{{ firebase_config.api_key }}",
            authDomain: "{{ firebase_config.auth_domain }}",
            projectId: "{{ firebase_config.project_id }}",
            storageBucket: "{{ firebase_config.storage_bucket }}",
            messagingSenderId: "{{ firebase_config.messaging_sender_id }}",
            appId: "{{ firebase_config.app_id }}",
            databaseURL: "{{ firebase_config.database_url }}"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>

    <!-- TensorFlow.js (Updated to 4.12.0) -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>

    <!-- Custom Firebase Config and Auth -->
    <script src="static/js/firebase-config.js" defer></script>
    <script src="static/js/auth.js" defer></script>
</head>

<body>

    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">AgroDx</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#tutorial">Get Started</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown">
                            More
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">About Us</a></li>
                            <li><a class="dropdown-item" href="#">Contact</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#loginModal">Login</a></li>
                            <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#registerModal">Register</a></li>
                        </ul>
                    </li>
                </ul>

                <!-- Alert Container for Auth Messages -->
                <div id="alert-container" class="position-fixed top-0 start-50 translate-middle-x mt-3"
                    style="z-index: 1050;"></div>

                <!-- User Display (shows when logged in) -->
                <div class="nav-item me-3 d-none" id="userDisplay">
                    <span class="text-light d-flex align-items-center">
                        <i class="fas fa-user-circle me-1"></i>
                        <span class="user-name"></span>
                    </span>
                </div>

                <div class="nav-buttons">
                    <!-- Language Selector -->
                    <div class="language-selector me-2 d-none d-lg-block">
                        <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" id="translateBtn"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-language"></i>
                            <span id="currentLanguage">Language</span>
                        </button>

                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="translateBtn">
                            <li><a class="dropdown-item" href="#" onclick="translatePage('en')">English</a></li>
                            <li><a class="dropdown-item" href="#" onclick="translatePage('hi')">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</a></li>
                            <li><a class="dropdown-item" href="#" onclick="translatePage('bn')">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</a></li>
                            <li><a class="dropdown-item" href="#" onclick="translatePage('te')">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</a></li>
                            <li><a class="dropdown-item" href="#" onclick="translatePage('ta')">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</a></li>
                            <li><a class="dropdown-item" href="#" onclick="translatePage('mr')">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</a></li>
                            <li><a class="dropdown-item" href="#" onclick="translatePage('gu')">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</a></li>
                            <li><a class="dropdown-item" href="#" onclick="translatePage('kn')">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</a></li>
                            <li><a class="dropdown-item" href="#" onclick="translatePage('ml')">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)</a></li>
                            <li><a class="dropdown-item" href="#" onclick="translatePage('pa')">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä (Punjabi)</a></li>
                            <li><a class="dropdown-item" href="#" onclick="translatePage('or')">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü (Odia)</a></li>
                        </ul>
                    </div>
                    
                    <!-- Auth Buttons (Only shown when logged out) -->
                    <div class="auth-buttons" id="authButtons">
                        <button type="button" class="btn btn-outline-light btn-sm" data-bs-toggle="modal" data-bs-target="#loginModal" id="loginBtn">
                            <i class="fas fa-sign-in-alt"></i> Login
                        </button>
                        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#registerModal" id="registerBtn">
                            <i class="fas fa-user-plus"></i> Register
                        </button>
                        <a href="{{ url_for('dashboard.index') }}" class="btn btn-primary btn-sm d-none" id="dashboardBtn">
                            <i class="fas fa-chart-line"></i> Dashboard
                        </a>
                        <button type="button" class="btn btn-outline-light btn-sm d-none" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Language Selector for Mobile (visible in collapsed menu) -->
    <div class="d-lg-none bg-dark py-2 px-3">
        <div class="language-selector-mobile">
            <button class="btn btn-outline-light btn-sm dropdown-toggle w-100" type="button" 
                    data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fas fa-language"></i>
                <span id="currentLanguageMobile">Language</span>
            </button>
            <ul class="dropdown-menu w-100" aria-labelledby="translateBtnMobile">
                <li><a class="dropdown-item" href="#" onclick="translatePage('en')">English</a></li>
                <li><a class="dropdown-item" href="#" onclick="translatePage('hi')">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</a></li>
                <li><a class="dropdown-item" href="#" onclick="translatePage('bn')">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</a></li>
                <li><a class="dropdown-item" href="#" onclick="translatePage('te')">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</a></li>
                <li><a class="dropdown-item" href="#" onclick="translatePage('ta')">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</a></li>
                <li><a class="dropdown-item" href="#" onclick="translatePage('mr')">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</a></li>
                <li><a class="dropdown-item" href="#" onclick="translatePage('gu')">‡™ó‡´Å‡™ú‡™∞‡™æ‡™§‡´Ä (Gujarati)</a></li>
                <li><a class="dropdown-item" href="#" onclick="translatePage('kn')">‡≤ï‡≤®‡≥ç‡≤®‡≤° (Kannada)</a></li>
                <li><a class="dropdown-item" href="#" onclick="translatePage('ml')">‡¥Æ‡¥≤‡¥Ø‡¥æ‡¥≥‡¥Ç (Malayalam)</a></li>
                <li><a class="dropdown-item" href="#" onclick="translatePage('pa')">‡®™‡©∞‡®ú‡®æ‡®¨‡©Ä (Punjabi)</a></li>
                <li><a class="dropdown-item" href="#" onclick="translatePage('or')">‡¨ì‡¨°‡¨º‡¨ø‡¨Ü (Odia)</a></li>
            </ul>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loginModalLabel">Login</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label">Email address</label>
                            <input type="email" class="form-control" id="loginEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="loginPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">Login</button>
                            <button type="button" id="googleSignIn" class="btn btn-outline-danger">
                                <i class="bi bi-google"></i> Sign in with Google
                            </button>
                        </div>
                    </form>
                    <hr>
                    <div class="text-center">
                        <p>Don't have an account? <a href="#" data-bs-toggle="modal" data-bs-target="#registerModal" data-bs-dismiss="modal">Register here</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Register Modal -->
    <div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="registerModalLabel">Register</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="registerForm">
                        <div class="mb-3">
                            <label for="registerName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="registerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerEmail" class="form-label">Email address</label>
                            <input type="email" class="form-control" id="registerEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="registerPassword" class="form-label">Password</label>
                            <input type="password" class="form-control" id="registerPassword" required>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">Register</button>
                            <button type="button" id="googleSignUp" class="btn btn-outline-danger">
                                <i class="bi bi-google"></i> Sign up with Google
                            </button>
                        </div>
                    </form>
                    <hr>
                    <div class="text-center">
                        <p>Already have an account? <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" data-bs-dismiss="modal">Login here</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Hero Section -->
    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
        <!-- Indicators -->
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1"></button>
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2"></button>
        </div>

        <!-- Slides -->
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="static/images/hero1.jpg" class="d-block w-100" alt="Slide 1">
                <div class="overlay"></div>
                <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
                    <h1>AI-Powered Plant Disease Detection</h1>
                    <h3>Early Detection Saves Crops</h3>
                    <p>Upload a leaf image and get instant diagnosis</p>
                </div>
            </div>

            <div class="carousel-item">
                <img src="static/images/hero2.jpg" class="d-block w-100" alt="Slide 2">
                <div class="overlay"></div>
                <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
                    <h1>Fast & Reliable Analysis</h1>
                    <h3>Powered by Advanced Neural Networks</h3>
                    <p>Diagnose plant diseases with 95% accuracy</p>
                </div>
            </div>

            <div class="carousel-item">
                <img src="static/images/hero3.jpg" class="d-block w-100" alt="Slide 3">
                <div class="overlay"></div>
                <div class="carousel-caption d-flex flex-column align-items-center justify-content-center">
                    <h1>Protect Your Crops</h1>
                    <h3>Prevent Yield Loss & Increase Productivity</h3>
                    <p>Get treatment recommendations instantly</p>
                </div>
            </div>
        </div>

        <!-- Navigation Buttons -->
        <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>


    <!-- Tutorial Section -->
    <section id="tutorial" class="tutorial-section">
        <div class="container">
            <div class="row align-items-center">

                <!-- Text Instructions -->
                <div class="col-lg-6 tutorial-text">
                    <h2>üì∏ How to Capture Plant Images for Disease Detection</h2>
                    <p>For best results with our AI-powered plant disease detection system, please follow these guidelines:</p>
                    <ul>
                        <li><strong>Use a white background</strong> - Place the leaf on a plain white sheet of paper or light background for better contrast.</li>
                        <li><strong>Good lighting</strong> - Ensure there is ample natural light to clearly show the leaf's details and symptoms.</li>
                        <li><strong>Focus on affected areas</strong> - Make sure disease spots, discoloration, or damage patterns are clearly visible.</li>
                        <li><strong>Capture the entire leaf</strong> - Include the full leaf in the frame to provide complete context.</li>
                        <li><strong>Avoid shadows</strong> - Try to eliminate shadows that might hide important disease features.</li>
                    </ul>

                    <h2>Plant Disease Detection</h2>

                    <!-- Toggle for Online vs. Offline Mode -->
                    <label for="mode-toggle">Choose Mode:</label>
                    <select id="mode-toggle">
                        <option value="online">Online Mode (Fast)</option>
                        <option value="offline">Offline Mode (No Internet)</option>
                    </select>

                    <!-- Online Mode Forms -->
                    <div id="online-mode">
                        <h3>Online Mode</h3>

                        <h4>Image-Based Disease Detection</h4>
                        <form action="/upload" method="POST" enctype="multipart/form-data" id="image-upload-form">
                            <div class="mb-3">
                                <label class="form-label">Take a photo or upload an image</label>
                                <div class="d-flex flex-column gap-3">
                                    <!-- Camera capture option -->
                                    <div class="camera-option">
                                        <button type="button" id="open-camera-online" class="btn btn-success w-100 mb-2">
                                            <i class="fas fa-camera me-2"></i>Take Photo
                                        </button>
                                        <div id="camera-feed-container-online" class="d-none">
                                            <video id="camera-feed-online" class="w-100 mb-2" autoplay playsinline></video>
                                            <div class="d-flex justify-content-between mb-3">
                                                <button type="button" id="capture-photo-online" class="btn btn-primary">
                                                    <i class="fas fa-camera me-1"></i>Capture
                                                </button>
                                                <button type="button" id="close-camera-online" class="btn btn-secondary">
                                                    <i class="fas fa-times me-1"></i>Close
                                                </button>
                                            </div>
                                            <canvas id="photo-canvas-online" class="d-none"></canvas>
                                        </div>
                                    </div>
                                    
                                    <!-- Divider with text -->
                                    <div class="text-center my-2">
                                        <span class="text-muted">- OR -</span>
                                    </div>
                                    
                                    <!-- File upload option -->
                                    <label for="image-input-online" class="form-label">Upload leaf photo on a white background</label>
                                    <input type="file" name="file" class="form-control" id="image-input-online"
                                        accept="image/*" required>
                                    <div id="image-preview" class="mt-2" style="display: none;">
                                        <img id="preview-image" class="img-fluid" style="max-width: 300px;">
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary">Detect Disease</button>
                        </form>

                        <h4>Symptoms-Based Detection (LLM)</h4>
                        <form action="/text-detection" method="POST" id="symptoms-form">
                            <div class="input-group mb-3">
                                <input type="text" name="text_input" id="symptoms-input" class="form-control"
                                    placeholder="Describe plant symptoms (yellowing, spots, wilting, etc.)..." required>
                                <button type="button" id="voice-input-btn" class="btn btn-secondary">
                                    <i class="fas fa-microphone"></i>
                                </button>
                            </div>
                            <div id="voice-status" class="mb-2 text-muted" style="font-size: 0.9em; min-height: 24px;">
                            </div>
                            <button type="submit" class="btn btn-success">Get Diagnosis</button>
                        </form>
                    </div>

                    <!-- Offline Mode (runs locally, without server connection) -->
                    <div id="offline-mode" style="display: none;">
                        <h3 class="mb-3">Offline Plant Disease Detection</h3>
                        <div class="card mb-4">
                            <div class="card-body">
                                <form id="offline-form">
                                    <div class="mb-3">
                                        <label class="form-label">Take a photo or upload an image</label>
                                        <div class="d-flex flex-column gap-3">
                                            <!-- Camera capture option -->
                                            <div class="camera-option">
                                                <button type="button" id="open-camera" class="btn btn-success w-100 mb-2">
                                                    <i class="fas fa-camera me-2"></i>Take Photo
                                                </button>
                                                <div id="camera-feed-container" class="d-none">
                                                    <video id="camera-feed" class="w-100 mb-2" autoplay playsinline></video>
                                                    <div class="d-flex justify-content-between mb-3">
                                                        <button type="button" id="capture-photo" class="btn btn-primary">
                                                            <i class="fas fa-camera me-1"></i>Capture
                                                        </button>
                                                        <button type="button" id="close-camera" class="btn btn-secondary">
                                                            <i class="fas fa-times me-1"></i>Close
                                                        </button>
                                                    </div>
                                                    <canvas id="photo-canvas" class="d-none"></canvas>
                                                </div>
                                            </div>
                                            
                                            <!-- Divider with text -->
                                            <div class="text-center my-2">
                                                <span class="text-muted">- OR -</span>
                                            </div>
                                            
                                            <!-- File upload option -->
                                            <label for="image-input" class="form-label">Upload an image of the plant</label>
                                            <input class="form-control" type="file" id="image-input" accept="image/*" required>
                                        </div>
                                    </div>
                                    <button type="button" id="detect-offline" class="btn btn-primary">
                                        <i class="fas fa-search me-2"></i>Detect Disease
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Result Display Area -->
                    <div id="result" class="mt-4"></div>


                </div>

                <!-- Video/Image Guide -->
                <div class="col-lg-6 tutorial-video">
                    <div class="video-container mb-5">
                        <!-- Tutorial Video Placeholder -->
                        <div class="video-placeholder mb-5">
                            <h3>Tutorial Video</h3>
                            <div class="ratio ratio-16x9 mt-3">
                                <div class="placeholder-video bg-light d-flex align-items-center justify-content-center">
                                    <div class="text-center">
                                        <i class="fas fa-video fa-4x mb-3 text-secondary"></i>
                                        <h5>Tutorial Video Coming Soon</h5>
                                        <p class="text-muted">A detailed video guide will be available here shortly</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="image-guide-container mt-5 pt-4">
                        <h3>Image Guide: How to Take Photos</h3>
                        <div class="card mb-3">
                            <div class="card-header bg-success text-white">
                                <i class="fas fa-check-circle me-2"></i> Good Example
                            </div>
                            <div class="card-body text-center">
                                <div class="placeholder-image bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                                    <div class="text-center">
                                        <i class="fas fa-image fa-3x mb-2 text-secondary"></i>
                                        <p class="text-muted mb-0">Good example image coming soon</p>
                                    </div>
                                </div>
                                <p class="mt-2 mb-0">Leaf on white background with disease symptoms clearly visible</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header bg-danger text-white">
                                <i class="fas fa-times-circle me-2"></i> Poor Example
                            </div>
                            <div class="card-body text-center">
                                <div class="placeholder-image bg-light d-flex align-items-center justify-content-center" style="height: 200px;">
                                    <div class="text-center">
                                        <i class="fas fa-image fa-3x mb-2 text-secondary"></i>
                                        <p class="text-muted mb-0">Poor example image coming soon</p>
                                    </div>
                                </div>
                                <p class="mt-2 mb-0">Dark background with shadows hiding disease features</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </section>


    <!-- About Section -->
    <div class="container mt-5">
        <h2 class="text-center section-title">Benefits of Plant Disease Detection</h2>

        <!-- Tabs Navigation -->
        <ul class="nav nav-tabs justify-content-center" id="aboutTabs">
            <li class="nav-item">
                <a class="nav-link active" id="tab1-tab" data-bs-toggle="tab" href="#tab1">Early Detection</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="tab2-tab" data-bs-toggle="tab" href="#tab2">Advanced Technology</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" id="tab3-tab" data-bs-toggle="tab" href="#tab3">Sustainable Farming</a>
            </li>
        </ul>

        <!-- Tabs Content -->
        <div class="tab-content mt-4">

            <!-- Tab 1 -->
            <div class="tab-pane fade show active" id="tab1">
                <div class="row">
                    <div class="col-md-4">
                        <div class="image-box">
                            <img src="static/images/about1.jpg" class="img-fluid" alt="Early Detection 1">
                            <p>Identify diseases before they spread</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="image-box">
                            <img src="static/images/about2.jpg" class="img-fluid" alt="Early Detection 2">
                            <p>Save up to 80% of affected crops</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="image-box">
                            <img src="static/images/about3.jpg" class="img-fluid" alt="Early Detection 3">
                            <p>Precision diagnosis within seconds</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 2 -->
            <div class="tab-pane fade" id="tab2">
                <div class="row">
                    <div class="col-md-4">
                        <div class="image-box">
                            <img src="static/images/about4.jpg" class="img-fluid" alt="Advanced Tech 1">
                            <p>Deep learning neural networks</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="image-box">
                            <img src="static/images/about5.jpg" class="img-fluid" alt="Advanced Tech 2">
                            <p>95% accuracy in disease identification</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="image-box">
                            <img src="static/images/about6.jpg" class="img-fluid" alt="Advanced Tech 3">
                            <p>Works on 30+ crop varieties</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 3 -->
            <div class="tab-pane fade" id="tab3">
                <div class="row">
                    <div class="col-md-4">
                        <div class="image-box">
                            <img src="static/images/about7.jpg" class="img-fluid" alt="Sustainable 1">
                            <p>Reduce pesticide use by 50%</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="image-box">
                            <img src="static/images/about8.jpg" class="img-fluid" alt="Sustainable 2">
                            <p>Target treatments precisely</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="image-box">
                            <img src="static/images/about9.jpg" class="img-fluid" alt="Sustainable 3">
                            <p>Lower environmental impact</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <!-- FAQ Section -->
    <div class="container mt-5">
        <h2 class="text-center section-title">Frequently Asked Questions</h2>

        <div class="accordion mt-4" id="faqAccordion">

            <!-- FAQ 1 -->
            <div class="accordion-item faq-item">
                <h2 class="accordion-header" id="faqHeading1">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#faqCollapse1">
                        What is AI-powered plant disease detection?
                    </button>
                </h2>
                <div id="faqCollapse1" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        AI-powered plant disease detection uses advanced neural networks to analyze images of plant leaves, 
                        identify disease patterns, and provide diagnosis and treatment recommendations with high accuracy. 
                        The system has been trained on thousands of images of diseased and healthy plants.
                    </div>
                </div>
            </div>

            <!-- FAQ 2 -->
            <div class="accordion-item faq-item">
                <h2 class="accordion-header" id="faqHeading2">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#faqCollapse2">
                        Which plant diseases can this system detect?
                    </button>
                </h2>
                <div id="faqCollapse2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        Our system can detect over 50 diseases across 14 different crop types including tomato, potato, 
                        apple, corn, rice, wheat, and more. Common detectable diseases include late blight, powdery mildew, 
                        leaf spots, rusts, bacterial infections, and nutrient deficiencies.
                    </div>
                </div>
            </div>

            <!-- FAQ 3 -->
            <div class="accordion-item faq-item">
                <h2 class="accordion-header" id="faqHeading3">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#faqCollapse3">
                        How accurate is the disease detection?
                    </button>
                </h2>
                <div id="faqCollapse3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        Our AI model achieves 95% accuracy in controlled testing environments with clear images of diseased 
                        leaves. For best results in real-world conditions, we recommend following our image capture guidelines: 
                        use good lighting, place leaves on a white background, and ensure disease symptoms are clearly visible.
                    </div>
                </div>
            </div>

            <!-- FAQ 4 -->
            <div class="accordion-item faq-item">
                <h2 class="accordion-header" id="faqHeading4">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#faqCollapse4">
                        Can I use the system without internet access?
                    </button>
                </h2>
                <div id="faqCollapse4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        Yes, our offline mode allows you to use the plant disease detection feature without an internet 
                        connection. The compact AI model runs locally on your device for basic disease detection. However, 
                        the full feature set, including detailed treatment recommendations and symptom-based detection, 
                        requires an internet connection.
                    </div>
                </div>
            </div>

            <!-- FAQ 5 -->
            <div class="accordion-item faq-item">
                <h2 class="accordion-header" id="faqHeading5">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#faqCollapse5">
                        What information do I receive after detection?
                    </button>
                </h2>
                <div id="faqCollapse5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        After analyzing your plant image, you'll receive a detailed report including the detected disease name, 
                        confidence level of the diagnosis, disease description, potential causes, recommended treatments, and 
                        preventive measures. For some common diseases, we also provide links to additional resources.
                    </div>
                </div>
            </div>

            <!-- FAQ 6 -->
            <div class="accordion-item faq-item">
                <h2 class="accordion-header" id="faqHeading6">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#faqCollapse6">
                        Can I detect multiple diseases at once?
                    </button>
                </h2>
                <div id="faqCollapse6" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        Yes, our advanced AI can detect multiple diseases present on a single leaf or plant. The system will 
                        identify the primary disease with the highest confidence score, along with secondary infections or 
                        conditions if present. For complex cases, we recommend uploading several images of different affected areas.
                    </div>
                </div>
            </div>

            <!-- FAQ 7 -->
            <div class="accordion-item faq-item">
                <h2 class="accordion-header" id="faqHeading7">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                        data-bs-target="#faqCollapse7">
                        Is my data kept private?
                    </button>
                </h2>
                <div id="faqCollapse7" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                    <div class="accordion-body">
                        We take your privacy seriously. Plant images you upload are processed securely and are not shared with 
                        third parties. We may anonymously use uploaded images to improve our AI model's accuracy, but only with 
                        your consent. You can opt out of this in your account settings at any time.
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Footer Section -->
    <footer class="footer">
        <div class="container">
            <div class="row">

                <!-- About Section -->
                <div class="col-lg-4 col-md-6 footer-about">
                    <h4>About AgroDx</h4>
                    <p>AgroDx is a cutting-edge plant disease detection platform that uses artificial intelligence to help 
                    farmers identify crop diseases early and take appropriate action to protect their harvests.</p>
                </div>

                <!-- Quick Links -->
                <div class="col-lg-4 col-md-6 footer-links">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#">Disease Library</a></li>
                        <li><a href="#">Treatment Guide</a></li>
                        <li><a href="#">FAQ</a></li>
                        <li><a href="#">Contact</a></li>
                    </ul>
                </div>

                <!-- Contact Info -->
                <div class="col-lg-4 col-md-12 footer-contact">
                    <h4>Contact Us</h4>
                    <p>Email: support@agrodx.com</p>
                    <p>Phone: +91 98765 43210</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>

            </div>

            <hr>

            <!-- Copyright -->
            <div class="text-center">
                <p>&copy; 2023 AgroDx. All Rights Reserved.</p>
            </div>
        </div>
    </footer>


    <!-- Bootstrap Script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Script to ensure page loads in English -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if this is the first visit
            if (!sessionStorage.getItem('userSelectedLanguage')) {
                // Set default language to English
                sessionStorage.setItem('userSelectedLanguage', 'en');
                
                // After Google Translate has initialized, force to English
                setTimeout(function() {
                    const select = document.querySelector('.goog-te-combo');
                    if (select && select.value !== 'en') {
                        select.value = 'en';
                        const event = new Event('change', { bubbles: true });
                        select.dispatchEvent(event);
                    }
                }, 2000);
            }
            
            // Add special handling for English button
            document.addEventListener('click', function(e) {
                if (e.target && e.target.closest('a') && e.target.textContent === 'English') {
                    e.preventDefault();
                    
                    // Force reload the page to get original English content
                    sessionStorage.setItem('userSelectedLanguage', 'en');
                    window.location.reload();
                }
            });
        });
    </script>

    <!-- Custom JavaScript -->
    <script src="static/js/script.js"></script>

    <!-- Firebase Authentication Handler -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is authenticated
            firebase.auth().onAuthStateChanged(function(user) {
                const authButtons = document.getElementById('authButtons');
                const userDisplay = document.getElementById('userDisplay');
                const dashboardBtn = document.getElementById('dashboardBtn');
                const loginBtn = document.getElementById('loginBtn');
                const registerBtn = document.getElementById('registerBtn');
                const logoutBtn = document.getElementById('logoutBtn');
                
                if (user) {
                    // User is signed in
                    console.log("User is signed in:", user.email);
                    
                    // Update user display
                    if (userDisplay) {
                        userDisplay.classList.remove('d-none');
                        const userNameElement = userDisplay.querySelector('.user-name');
                        if (userNameElement) {
                            userNameElement.textContent = user.displayName || user.email;
                        }
                    }
                    
                    // Update buttons
                    if (loginBtn) loginBtn.classList.add('d-none');
                    if (registerBtn) registerBtn.classList.add('d-none');
                    if (dashboardBtn) dashboardBtn.classList.remove('d-none');
                    if (logoutBtn) logoutBtn.classList.remove('d-none');
                    
                } else {
                    // User is not signed in
                    console.log("User is signed out");
                    
                    // Update user display
                    if (userDisplay) {
                        userDisplay.classList.add('d-none');
                    }
                    
                    // Update buttons
                    if (loginBtn) loginBtn.classList.remove('d-none');
                    if (registerBtn) registerBtn.classList.remove('d-none');
                    if (dashboardBtn) dashboardBtn.classList.add('d-none');
                    if (logoutBtn) logoutBtn.classList.add('d-none');
                }
            });
            
            // Login form submission
            document.getElementById('loginForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                firebase.auth().signInWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Close modal
                        bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
                        // Success message
                        showAlert('success', 'Logged in successfully!');
                    })
                    .catch((error) => {
                        showAlert('danger', error.message);
                    });
            });
            
            // Registration form submission
            document.getElementById('registerForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const name = document.getElementById('registerName').value;
                const email = document.getElementById('registerEmail').value;
                const password = document.getElementById('registerPassword').value;
                
                firebase.auth().createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Update profile with name
                        return userCredential.user.updateProfile({
                            displayName: name
                        }).then(() => {
                            // Close modal
                            bootstrap.Modal.getInstance(document.getElementById('registerModal')).hide();
                            // Success message
                            showAlert('success', 'Account created successfully!');
                        });
                    })
                    .catch((error) => {
                        showAlert('danger', error.message);
                    });
            });
            
            // Google Sign In
            document.getElementById('googleSignIn')?.addEventListener('click', function() {
                const provider = new firebase.auth.GoogleAuthProvider();
                firebase.auth().signInWithPopup(provider)
                    .then((result) => {
                        // Close modal
                        bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
                        // Success message
                        showAlert('success', 'Logged in with Google successfully!');
                    }).catch((error) => {
                        showAlert('danger', error.message);
                    });
            });
            
            // Google Sign Up (same as Sign In for Google)
            document.getElementById('googleSignUp')?.addEventListener('click', function() {
                const provider = new firebase.auth.GoogleAuthProvider();
                firebase.auth().signInWithPopup(provider)
                    .then((result) => {
                        // Close modal
                        bootstrap.Modal.getInstance(document.getElementById('registerModal')).hide();
                        // Success message
                        showAlert('success', 'Account created with Google successfully!');
                    }).catch((error) => {
                        showAlert('danger', error.message);
                    });
            });
            
            // Logout button
            document.getElementById('logoutBtn')?.addEventListener('click', function() {
                firebase.auth().signOut()
                    .then(() => {
                        showAlert('success', 'Logged out successfully!');
                    })
                    .catch((error) => {
                        showAlert('danger', error.message);
                    });
            });
            
            // Helper function to show alerts
            function showAlert(type, message) {
                const alertContainer = document.getElementById('alert-container');
                if (alertContainer) {
                    const alertHTML = `
                        <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                            ${message}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    `;
                    alertContainer.innerHTML = alertHTML;
                    
                    // Auto-dismiss after 5 seconds
                    setTimeout(() => {
                        const alert = alertContainer.querySelector('.alert');
                        if (alert) {
                            const bsAlert = new bootstrap.Alert(alert);
                            bsAlert.close();
                        }
                    }, 5000);
                }
            }
        });
    </script>

    <!-- Hidden element for Google Translate -->
    <div id="google_translate_element" style="display: none;"></div>

    <!-- Dashboard redirect script -->
    <script>
        // Check for 'next' parameter in URL and redirect if needed
        document.addEventListener('DOMContentLoaded', function() {
            // Get URL parameters
            const urlParams = new URLSearchParams(window.location.search);
            const nextPath = urlParams.get('next');
            
            if (nextPath) {
                // Make the dashboard button work directly
                const dashboardBtn = document.getElementById('dashboardBtn');
                if (dashboardBtn) {
                    dashboardBtn.href = nextPath;
                    // Don't remove the d-none class here, as auth.js handles visibility based on login state
                }
            } else {
                // If no next parameter, set default dashboard link
                const dashboardBtn = document.getElementById('dashboardBtn');
                if (dashboardBtn) {
                    dashboardBtn.href = "{{ url_for('dashboard.index') }}";
                    // Don't remove the d-none class here, as auth.js handles visibility based on login state
                }
            }
        });
    </script>

    <!-- Add custom styles for the language selector -->
    <style>
        .language-selector {
            position: relative;
        }

        #translateBtn {
            min-width: 120px;
            text-align: left;
            color: #fff;
            background: transparent;
            border-color: #fff;
        }

        #translateBtn:hover,
        #translateBtn:focus,
        #translateBtn:active {
            color: #fff;
            background-color: rgba(255, 255, 255, 0.1);
            border-color: #fff;
        }

        #translateBtn i {
            margin-right: 5px;
        }

        .dropdown-menu {
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* Enhanced CSS for language dropdown */
        .language-selector .dropdown-menu.show {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 1050;
            width: auto;
            min-width: 10rem;
            margin: 0.5rem 0 0;
            padding: 0.5rem 0;
            color: #212529;
            text-align: left;
            list-style: none;
            background-color: #fff;
            background-clip: padding-box;
            border: 1px solid rgba(0, 0, 0, 0.15);
            border-radius: 0.25rem;
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        
        .language-selector .dropdown-menu .dropdown-item {
            display: block;
            width: 100%;
            padding: 0.25rem 1.5rem;
            clear: both;
            font-weight: 400;
            color: #212529;
            text-align: inherit;
            white-space: nowrap;
            background-color: transparent;
            border: 0;
            cursor: pointer;
        }
        
        .language-selector .dropdown-menu .dropdown-item:hover,
        .language-selector .dropdown-menu .dropdown-item:focus {
            color: #16181b;
            text-decoration: none;
            background-color: #f8f9fa;
        }
    </style>

    <!-- Speech Recognition Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Setup for online mode voice input
            setupVoiceRecognition('voice-input-btn', 'symptoms-input', 'voice-status');

            // Setup for offline mode voice input
            setupVoiceRecognition('offline-voice-btn', 'offline-symptoms-input', 'offline-voice-status');

            // Function to set up voice recognition for any input
            function setupVoiceRecognition(buttonId, inputId, statusId) {
                const voiceButton = document.getElementById(buttonId);
                const inputField = document.getElementById(inputId);
                const statusElement = document.getElementById(statusId);

                if (!voiceButton || !inputField || !statusElement) return;

                // Check if speech recognition is supported
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    // Initialize speech recognition
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    const recognition = new SpeechRecognition();

                    recognition.continuous = false;
                    recognition.interimResults = true;

                    // Try to set language based on user's browser language
                    const userLanguage = navigator.language || navigator.userLanguage || 'en-US';
                    recognition.lang = userLanguage;

                    let isListening = false;

                    voiceButton.addEventListener('click', function () {
                        if (isListening) {
                            // Stop listening
                            recognition.stop();
                            voiceButton.classList.remove('btn-danger');
                            voiceButton.classList.add('btn-secondary');
                            statusElement.textContent = '';
                        } else {
                            // Start listening
                            recognition.start();
                            voiceButton.classList.remove('btn-secondary');
                            voiceButton.classList.add('btn-danger');
                            statusElement.textContent = 'Listening... Speak now';
                        }
                        isListening = !isListening;
                    });

                    recognition.onresult = function (event) {
                        let interimTranscript = '';
                        let finalTranscript = '';

                        for (let i = event.resultIndex; i < event.results.length; i++) {
                            const transcript = event.results[i][0].transcript;
                            if (event.results[i].isFinal) {
                                finalTranscript += transcript;
                            } else {
                                interimTranscript += transcript;
                            }
                        }

                        if (finalTranscript) {
                            inputField.value = finalTranscript;
                            statusElement.textContent = 'Recognized: ' + finalTranscript;
                        } else if (interimTranscript) {
                            statusElement.textContent = 'Hearing: ' + interimTranscript;
                        }
                    };

                    recognition.onerror = function (event) {
                        statusElement.textContent = 'Error: ' + event.error;
                        voiceButton.classList.remove('btn-danger');
                        voiceButton.classList.add('btn-secondary');
                        isListening = false;
                    };

                    recognition.onend = function () {
                        voiceButton.classList.remove('btn-danger');
                        voiceButton.classList.add('btn-secondary');
                        isListening = false;
                        if (!statusElement.textContent.includes('Recognized:')) {
                            statusElement.textContent = 'Click the microphone button to speak again';
                        }
                    };
                } else {
                    // Speech recognition not supported
                    voiceButton.disabled = true;
                    voiceButton.title = 'Speech recognition not supported in this browser';
                    statusElement.textContent = 'Voice input not supported in your browser. Please type symptoms manually.';
                }
            }

            // Handle the offline symptom diagnosis button
            document.getElementById('offline-symptom-btn')?.addEventListener('click', function () {
                const inputText = document.getElementById('offline-symptoms-input').value;
                if (!inputText.trim()) {
                    alert('Please describe the plant symptoms first.');
                    return;
                }

                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = `
                    <div class="alert alert-warning">
                        <p><strong>Offline Mode:</strong> Symptom-based detection requires internet connection.</p>
                        <p>Your input: "${inputText}"</p>
                        <p>Please switch to online mode for symptom-based diagnosis.</p>
                    </div>
                `;
            });
        });
    </script>

    <!-- Add custom styles for result display -->
    <style>
        #result .card {
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        #result .card:hover {
            transform: translateY(-2px);
        }

        #result .card-body {
            padding: 1.5rem;
        }

        #result .alert {
            margin-bottom: 0;
        }

        #result .img-fluid {
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #image-preview {
            text-align: center;
            margin: 1rem 0;
        }

        #preview-image {
            max-height: 300px;
            object-fit: contain;
        }
    </style>

    <!-- Add JavaScript for image preview -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Image preview for online mode
            const imageInputOnline = document.getElementById('image-input-online');
            const imagePreview = document.getElementById('image-preview');
            const previewImage = document.getElementById('preview-image');

            if (imageInputOnline) {
                imageInputOnline.addEventListener('change', function () {
                    const file = this.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            previewImage.src = e.target.result;
                            imagePreview.style.display = 'block';
                        }
                        reader.readAsDataURL(file);
                    }
                });
            }
        });
    </script>

    <!-- Offline Mode Instructions -->
    <script>
        // Add listener for offline/online status
        window.addEventListener('offline', function() {
            // Create alert if it doesn't exist
            if (!document.getElementById('offline-alert')) {
                const alertDiv = document.createElement('div');
                alertDiv.id = 'offline-alert';
                alertDiv.className = 'alert alert-warning alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x';
                alertDiv.style.zIndex = '9999';
                alertDiv.style.marginTop = '20px';
                alertDiv.innerHTML = `
                    <strong><i class="fas fa-wifi-slash me-2"></i>You are now offline!</strong> 
                    <p class="mb-0">The AI model will continue to work for image detection. Do not refresh the page to avoid data loss.</p>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                `;
                document.body.appendChild(alertDiv);
            }
        });

        window.addEventListener('online', function() {
            const alert = document.getElementById('offline-alert');
            if (alert) {
                alert.remove();
            }
        });
        
        // Prevent accidental refresh when in offline mode
        window.addEventListener('beforeunload', function(e) {
            if (!navigator.onLine) {
                e.preventDefault();
                e.returnValue = 'You are currently offline. Refreshing the page may cause data loss. Are you sure you want to continue?';
            }
        });
    </script>

    <!-- Add custom styles for the tutorial section -->
    <style>
        .tutorial-section {
            padding: 4rem 0;
            background-color: #f8f9fa;
        }
        
        .tutorial-text {
            padding-right: 2rem;
        }
        
        .tutorial-video {
            position: relative;
            z-index: 1;
        }
        
        .video-container {
            position: relative;
            z-index: 1;
            margin-bottom: 30px;
        }
        
        .image-guide-container {
            margin-top: 40px;
            position: relative;
            z-index: 1;
        }
        
        .placeholder-video, .placeholder-image {
            border-radius: 8px;
            border: 2px dashed #dee2e6;
        }
        
        .card {
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-2px);
        }
        
        .card-header {
            border-radius: 8px 8px 0 0 !important;
        }
    </style>

    <!-- Add JavaScript to debug form submission -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const imageUploadForm = document.getElementById('image-upload-form');
            
            if (imageUploadForm) {
                imageUploadForm.addEventListener('submit', function(e) {
                    // Don't prevent default as we want the form to submit normally
                    console.log('Form is submitting to: ' + this.action);
                    
                    // Check if the file input has a file
                    const fileInput = document.getElementById('image-input-online');
                    if (fileInput && fileInput.files.length === 0) {
                        e.preventDefault();
                        alert('Please select an image file to upload.');
                        return false;
                    }
                    
                    // If we have a file, proceed with submission
                    return true;
                });
            }
        });
    </script>

</body>

</html>